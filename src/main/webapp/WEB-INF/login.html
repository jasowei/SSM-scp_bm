<!DOCTYPE HTML>
<html>
<head>
    <meta charset="utf-8">
    <meta name="renderer" content="webkit|ie-comp|ie-stand">
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
    <meta name="viewport"
          content="width=device-width,initial-scale=1,minimum-scale=1.0,maximum-scale=1.0,user-scalable=no"/>
    <meta http-equiv="Cache-Control" content="no-siteapp"/>
    <!--[if lt IE 9]>
    <script type="text/javascript" src="/resources/lib/html5shiv.js"></script>
    <script type="text/javascript" src="/resources/lib/respond.min.js"></script>
    <![endif]-->
    <link href="/resources/static/h-ui/css/H-ui.min.css" rel="stylesheet" type="text/css"/>
    <link href="/resources/static/h-ui.admin/css/H-ui.login.css" rel="stylesheet" type="text/css"/>
    <link href="/resources/static/h-ui.admin/css/style.css" rel="stylesheet" type="text/css"/>
    <link href="/resources/lib/Hui-iconfont/1.0.8/iconfont.css" rel="stylesheet" type="text/css"/>
    <link rel="stylesheet" type="text/css" href="/resources/static/h-ui.admin/css/H-ui.admin.css"/>
    <link rel="stylesheet" type="text/css" href="/resources/static/h-ui.admin/skin/default/skin.css" id="skin"/>
    <!--[if IE 6]>
    <script type="text/javascript" src="/resources/lib/DD_belatedPNG_0.0.8a-min.js"></script>
    <script>DD_belatedPNG.fix('*');</script>
    <![endif]-->
    <title>后台登录</title>
    <meta name="keywords" content="H-ui.admin v3.1,H-ui网站后台模版,后台模版下载,后台管理系统模版,HTML后台模版下载">
    <meta name="description" content="H-ui.admin v3.1，是一款由国人开发的轻量级扁平化网站后台模板，完全免费开源的网站后台管理系统模版，适合中小型CMS后台系统。">
</head>

<body>
<input type="hidden" id="TenantId" name="TenantId" value=""/>

<div class="header">
    <span style="color: white;font-size: 36px">&nbsp;&nbsp;&nbsp;小区业主服务平台--后台管理系统</span>
</div>

<div class="loginWraper">
    <div id="loginform" class="loginBox" style="color:white;">
        <form class="form form-horizontal" action="" method="post">
            <div class="row cl">
                <div class="formControls col-xs-8 col-xs-offset-3">
                    <input id="name" name="admin_name" type="text" placeholder="账户ID" class="input-text size-L">
                </div>
            </div>
            <div class="row cl">
                <div class="formControls col-xs-8 col-xs-offset-3">
                    <input id="password" name="" type="password" placeholder="密码" class="input-text size-L">
                </div>
            </div>
            <div class="row cl">
                <div class="formControls col-xs-8 col-xs-offset-3">
                    <input id="code" class="input-text size-L" type="text" placeholder="验证码"
                           style="width:150px;">
                    <img id="verifyCodeImage" src="/getVerifyCode" alt="验证码"
                         title="验证码图片"/>
                    <a onclick="changeImage()" style="color:white;">看不清，换一张</a>
                </div>
            </div>
            <div class="row cl">
                <div class="formControls col-xs-8 col-xs-offset-3">
                    <label for="online">
                        <input type="checkbox" name="online" id="online" value="">
                        使我保持登录状态</label>
                        &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
                    <a onclick="popup()">忘记密码?</a>
                </div>
            </div>
            <div class="row cl">
                <div class="formControls col-xs-8 col-xs-offset-3">
                    <input id="submit" name="" type="button" class="btn btn-success radius size-L"
                           value="&nbsp;登&nbsp;&nbsp;&nbsp;&nbsp;录&nbsp;">
                    <input name="" type="reset" class="btn btn-default radius size-L"
                           value="&nbsp;取&nbsp;&nbsp;&nbsp;&nbsp;消&nbsp;">
                </div>
            </div>
        </form>
    </div>
</div>

<div class="footer">Copyright JASO by SSM-Project</div>

<!--w2ui-->
<link type="text/css" rel="stylesheet" href="/resources/w2ui-1.5.rc1/w2ui-1.5.rc1.css"/>
<!--_footer 作为公共模版分离出去-->
<script type="text/javascript" src="/resources/lib/jquery/1.9.1/jquery.min.js"></script>
<script type="text/javascript" src="/resources/lib/layer/2.4/layer.js"></script>
<script type="text/javascript" src="/resources/static/h-ui/js/H-ui.min.js"></script>
<script type="text/javascript" src="/resources/static/h-ui.admin/js/H-ui.admin.js"></script>
<!--/_footer 作为公共模版分离出去-->
<script type="text/javascript" src="/resources/w2ui-1.5.rc1/w2ui-1.5.rc1.js"></script>
<!--w2ui-->

<!--请在下方写此页面业务相关的脚本-->
<script type="text/javascript" src="/resources/lib/datatables/1.10.0/jquery.dataTables.min.js"></script>

<script>
    /*点击更新验证码*/
    function changeImage() {
        $("#verifyCodeImage").attr('src', '/getVerifyCode?a=' + Math.random());
    }

    /* 登录 */
    $("#submit").click(function submit() {

        // 获取输入的登录名, 密码, 验证码
        var name = $("#name").val();
        var password = $("#password").val();
        var code = $("#code").val();

        // 判空
        if (name == '') {
            layer.msg('用户名不能为空',{icon:2,time:3000});
            return false;
        }

        if (password == '') {
            layer.msg('密码不能为空',{icon:2,time:3000});
            return false;
        }

        if (code == '') {
            layer.msg('验证码不能为空',{icon:2,time:3000});
            return false;
        }

        // 存入cookie
        $.cookie("login_name",name);
        $.cookie("password", password);

        $.ajax({
            type: "post",
            url: "/loginAdmin",
            data: {
                "login_name": name,
                "password": password,
                "code": code
            },
            success: function (result) {
                if (result.status == false){
                    layer.msg('登录失败 '+result.message,{icon:2,time:3000});
                }else if(result.status == true) {
                    layer.msg('登录成功 ',{icon:1,time:3000});
                    location.href = "/index"
                } else {
                    submit();
                }
            },
            error: function (XmlHttpRequest, textStatus, errorThrown) {
                layer.msg('error-login!', {icon: 2, time: 3000});
            }
        })
    })


    //        忘记密码
    function popup() {
        w2popup.open({
            width: 400,
            height: 300,
            title: '{ 忘 记 密 码 }',
            body: '<div class="w2ui-centered"><h2>是不是忘记密码了?</h2>' +
            '<h4>通过您注册时使用的邮箱,验证找回密码.</h4>' +
            '<br><br><br>  <input id="email" type="text" class="width200"/></div>',
            buttons: '<button class="w2ui-btn" onclick="verifyEmail()">验证邮箱</button>' +
            '<button class="w2ui-btn" onclick="w2popup.close();">我只是输入错误</button>',
            showMax: true
        });
    }
    //验证邮箱
    function verifyEmail() {
      $.ajax({
            url: "verifyEmail",
            type: "get",
            data: {
                "email": $("#email").val()
            },
            success: function (data) {
                if (data == 1) {
                    //ok
                    popup1();
                } else if (data == 0){
                    //no
                    popup3();
                  }
            },error: function(XmlHttpRequest, textStatus, errorThrown){
                layer.msg('error!',{icon:2,time:3000});
            }

        });
    }

    function popup1() {
        w2popup.lock("loading...", true);
        setTimeout(function () { w2popup.unlock(); }, 3000);
        w2alert("新的初始密码正发送到您的邮箱...");
        $.ajax({
            url: "sendEmail",
            type: "post",
            data: {
                "email": $("#email").val()
            },
            success: function (data) {
                if (data == 1){
                    w2popup.open({
                        title: ' 邮件已发送成功:',
                        body: '<div class="w2ui-centered"><h1>√  新密码已发送到邮箱,请注意查收!</h1>'
                    });
                }
            },error: function(XmlHttpRequest, textStatus, errorThrown){
                layer.msg('error!',{icon:2,time:3000});
            }

        });

    }

    //邮箱无效
    function popup3() {
        w2alert("× 邮箱地址不存在,请重新确认您的邮箱!");
    }


</script>

</body>
</html>