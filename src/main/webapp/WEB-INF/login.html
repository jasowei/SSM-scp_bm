<!DOCTYPE HTML>
<html>
<head>
    <meta charset="utf-8">
    <meta name="renderer" content="webkit|ie-comp|ie-stand">
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
    <meta name="viewport"
          content="width=device-width,initial-scale=1,minimum-scale=1.0,maximum-scale=1.0,user-scalable=no"/>
    <meta http-equiv="Cache-Control" content="no-siteapp"/>
    <!--[if lt IE 9]>
    <script type="text/javascript" src="/resources/lib/html5shiv.js"></script>
    <script type="text/javascript" src="/resources/lib/respond.min.js"></script>
    <![endif]-->
    <link href="/resources/static/h-ui/css/H-ui.min.css" rel="stylesheet" type="text/css"/>
    <link href="/resources/static/h-ui.admin/css/H-ui.login.css" rel="stylesheet" type="text/css"/>
    <link href="/resources/static/h-ui.admin/css/style.css" rel="stylesheet" type="text/css"/>
    <link href="/resources/lib/Hui-iconfont/1.0.8/iconfont.css" rel="stylesheet" type="text/css"/>
    <link rel="stylesheet" type="text/css" href="/resources/static/h-ui.admin/css/H-ui.admin.css"/>
    <link rel="stylesheet" type="text/css" href="/resources/static/h-ui.admin/skin/default/skin.css" id="skin"/>
    <!--[if IE 6]>
    <script type="text/javascript" src="/resources/lib/DD_belatedPNG_0.0.8a-min.js"></script>
    <script>DD_belatedPNG.fix('*');</script>
    <![endif]-->
    <title>后台登录</title>

    <!--bootstrap-->
    <link rel="stylesheet" href="/resources/bs/css/bootstrap.css">
    <script src="/resources/jquery-3.2.1.min.js"></script>
    <script src="/resources/bs/js/bootstrap.js"></script>

    <meta name="keywords" content="H-ui.admin v3.1,H-ui网站后台模版,后台模版下载,后台管理系统模版,HTML后台模版下载">
    <meta name="description" content="H-ui.admin v3.1，是一款由国人开发的轻量级扁平化网站后台模板，完全免费开源的网站后台管理系统模版，适合中小型CMS后台系统。">
</head>

<body>


<input type="hidden" id="TenantId" name="TenantId" value=""/>


<div class="header">
    <span style="color: white;font-size: 30px">&nbsp;&nbsp;&nbsp;小区业主服务平台--后台管理系统</span>
</div>

<div class="loginWraper">
    <div id="loginform" class="loginBox">
        <form class="form form-horizontal" action="" method="post">
            <div class="row cl">
                <div class="formControls col-xs-8 col-xs-offset-3" style="text-align: center">
                    <h3>后台系统-入口</h3>
                </div>
            </div>
            <div class="row cl">
                <div class="formControls col-xs-8 col-xs-offset-3" style="text-align: center">
                    <input id="name" name="admin_name" type="text" placeholder="System ID" class="input-text size-L">
                    <input id="password" name="" type="password" placeholder="密码" class="input-text size-L">
                </div>
            </div>
            <div class="row cl">
                <div class="formControls col-xs-8 col-xs-offset-3" style="text-align: right">

                    <button class="btn btn-primary" type="button"
                            data-toggle="collapse" data-target="#collapseExample" aria-expanded="false" aria-controls="collapseExample">
                        Auth &nbsp;<span class="glyphicon glyphicon-circle-arrow-right" aria-hidden="true"></span>
                    </button>
                    <div class="collapse" id="collapseExample" style="text-align: center">
                        <div class="well">
                            <img id="verifyCodeImage" src="/getVerifyCode" alt="验证码"
                                 title="验证码图片"/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
                            <a onclick="changeImage()" style="color:#298db9;">看不清，换一张</a>
                            <br>
                            <br>
                            <input id="code" class="input-text size-L" type="text" placeholder="请输入图片中内容:"
                                   style="width:150px;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
                            <input id="submit" name="" type="button" class="btn btn-primary"
                                   value="&nbsp;登&nbsp;&nbsp;&nbsp;&nbsp;录&nbsp;">
                        </div>
                    </div>

                </div>
            </div>
            <div class="row cl">
                <div class="formControls col-xs-8 col-xs-offset-3" style="text-align: center">
                    <hr>
                    <a onclick="popup()" style="color:#298db9;font-size: 16px">忘记密码?找回密码</a>
                    <br>
                    还没有此ID,<a href="#" style="color:#298db9;font-size: 14px">注册一个新的ID?</a>
                </div>
            </div>

        </form>
    </div>

</div>

<div class="footer">Copyright JASO by SSM-Project</div>

<!--w2ui-->
<link type="text/css" rel="stylesheet" href="/resources/w2ui-1.5.rc1/w2ui-1.5.rc1.css"/>
<!--_footer 作为公共模版分离出去-->
<script type="text/javascript" src="/resources/lib/jquery/1.9.1/jquery.min.js"></script>
<script type="text/javascript" src="/resources/lib/layer/2.4/layer.js"></script>
<script type="text/javascript" src="/resources/static/h-ui/js/H-ui.min.js"></script>
<script type="text/javascript" src="/resources/static/h-ui.admin/js/H-ui.admin.js"></script>
<!--/_footer 作为公共模版分离出去-->
<script type="text/javascript" src="/resources/w2ui-1.5.rc1/w2ui-1.5.rc1.js"></script>
<!--w2ui-->

<!--请在下方写此页面业务相关的脚本-->
<script type="text/javascript" src="/resources/lib/datatables/1.10.0/jquery.dataTables.min.js"></script>

<script>
    /*点击更新验证码*/
    function changeImage() {
        $("#verifyCodeImage").attr('src', '/getVerifyCode?a=' + Math.random());
    }

    /* 登录 */
    $("#submit").click(function submit() {

        // 获取输入的登录名, 密码, 验证码
        var name = $("#name").val();
        var password = $("#password").val();
        var code = $("#code").val();

        // 判空
        if (name == '') {
            layer.msg('用户名不能为空',{icon:2,time:3000});
            return false;
        }

        if (password == '') {
            layer.msg('密码不能为空',{icon:2,time:3000});
            return false;
        }



        if (code == '') {
            layer.msg('验证码不能为空',{icon:2,time:3000});
            return false;
        }

        // 存入cookie
        $.cookie("login_name",name);
        $.cookie("password", password);

        $.ajax({
            type: "post",
            url: "/loginAdmin",
            data: {
                "login_name": name,
                "password": password,
                "code": code
            },
            success: function (result) {
                if (result.status == false){
                    layer.msg('登录失败 '+result.message,{icon:2,time:3000});
                }else if(result.status == true) {
                    layer.msg('登录成功 ',{icon:1,time:3000});
                    location.href = "/index"
                } else {
                    submit();
                }
            },
            error: function (XmlHttpRequest, textStatus, errorThrown) {
                layer.msg('系统繁忙,请重新提交!', {icon: 0, time: 3000});
            }
        })
    })


    //        忘记密码
    function popup() {
        w2popup.open({
            width: 400,
            height: 300,
            title: ' 忘 记 密 码 ',
            body: '<div class="w2ui-centered"><h3>找回密码</h3>' +
            '<h4>通过您注册时使用的邮箱,验证找回密码.</h4>' +
            '<br><br><br>  <input id="email" type="text" class="width200"/></div>',
            buttons: '<button class="w2ui-btn" onclick="verifyEmail()">验证邮箱</button>' +
            '<button class="w2ui-btn" onclick="w2popup.close();">我还能想起来</button>',
            showMax: true
        });
    }
    //验证邮箱
    function verifyEmail() {
      $.ajax({
            url: "verifyEmail",
            type: "get",
            data: {
                "email": $("#email").val()
            },
            success: function (data) {
                if (data == 1) {
                    //ok
                    popup1();
                } else if (data == 0){
                    //no
                    popup3();
                  }
            },error: function(XmlHttpRequest, textStatus, errorThrown){
                layer.msg('error!',{icon:2,time:3000});
            }

        });
    }

    function popup1() {
        w2popup.lock("sending...", true);
        setTimeout(function () { w2popup.unlock(); }, 20000);
        $.ajax({
            url: "sendEmail",
            type: "post",
            data: {
                "email": $("#email").val()
            },
            success: function (data) {
                if (data == 1){
                    w2popup.open({
                        title: ' 邮件已发送成功:',
                        body: '<div class="w2ui-centered"><h1>√  新密码已发送到邮箱,请注意查收!</h1>'
                    });
                }
            },error: function(XmlHttpRequest, textStatus, errorThrown){
                layer.msg('error!',{icon:2,time:3000});
            }

        });

    }

    //邮箱无效
    function popup3() {
        w2alert("× 邮箱地址不存在,请重新确认您的邮箱!");
    }


</script>

</body>
</html>